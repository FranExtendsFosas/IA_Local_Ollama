# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# ==========================================
# 1. CONFIGURACI칍N OH-MY-ZSH Y TEMA
# ==========================================
# Ruta principal de Oh My Zsh
export ZSH="$HOME/.oh-my-zsh"

# Tema visual activo (Powerlevel10k)
ZSH_THEME="powerlevel10k/powerlevel10k"

# Lista de plugins activos (A침adir con cuidado para no ralentizar el inicio)
plugins=(git zsh-autosuggestions zsh-syntax-highlighting)
source $ZSH/oh-my-zsh.sh

# ==========================================
# 2. ALIASES Y UTILIDADES DE SISTEMA
# ==========================================
# Forzar a la utilidad 'tldr' (manuales resumidos) a priorizar espa침ol
alias tldr="LANGUAGE=es:en tldr"
# ==========================================
# 3. ASISTENTE INTELIGENCIA ARTIFICIAL (QWEN)
# ==========================================
# Funciones base ocultas (A칤slan y evitan falsos volcados de variables por usar espacios en los textos)
function _ia_fn() { sgpt --repl "$*" }
function _cons_fn() { sgpt "$*" }
function _cod_fn() { sgpt --code "$*" }

function _cmd_fn() { 
    echo -e "\e[1;36m游뱄 Qwen est치 buscando el comando exacto...\e[0m"
    local cmd_crudo=$(sgpt --role "Shell Command Generator" "$*")
    # Fuerza el procesado de caracteres especiales e ignora explicaciones basura del modelo
    local comando=$(echo "$cmd_crudo" | grep -a -v '```' | grep -a -v '^#' | sed 's/^`//; s/`$//' | sed '/^$/d' | head -n 1)
    
    echo -e "\e[1;36m游뱄 Qwen est치 resumiendo su utilidad...\e[0m"
    local desc_crudo=$(sgpt --role "Shell Command Descriptor" "$comando")
    local comentario=$(echo "$desc_crudo" | tr '\n' ' ' | tr '\r' ' ' | sed 's/^[ \t]*//')
    
    # Inyecta en la l칤nea de escritura la explicaci칩n (comentada) para aprender y el comando para usar
    print -z "${comentario}
${comando}" 
}

# Alias principales (Con 'noglob' le evitamos a Zsh interpretar s칤mbolos de interrogaci칩n como rutas)
alias cons="noglob _cons_fn" # [Consulta R치pida] Dispara, responde y limpia su propia memoria.
alias ia="noglob _ia_fn"     # [Chat Infinito] Crea ambiente continuo reteniendo el texto anterior.
alias cmd="noglob _cmd_fn"   # [Comandos GNU] Dedicado a tareas puras usando diccionario comentado.
alias cod="noglob _cod_fn"   # [Programaci칩n] Genera solo pedazos de c칩digo de lenguajes limpios.
# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
# ==========================================
# 4. INSTANCIAS Y RUTAS TERCEROS
# ==========================================
# Inicializamos compatibilidad del configurador gr치fico de Powerlevel10k
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# Accesos directos a binarios a침adidos manualmente (ej. LM Studio CLI)
export PATH="$PATH:$HOME/.lmstudio/bin"
